<body>

    <head>
        <script src="http://192.168.0.156:4200/dist/atrys-sdk.js" type="module"></script>
        <script type="module">

            try {
                const mit = new MIT('MEDIC-B2C', '-----BEGIN RSA PUBLIC KEY-----MIIBCgKCAQEAl5tcO7vU9rl8YMFqpdp8oIeFyLJyAgfydNdT31ricY2D1pv+70CL5p5992w1iXIXunWeD0yRn0tDqOiBDzXRNpkn3niImWpdtZi81hLNl2pF2MC+CWhDIY8RftGQqZLKZkDpYCFUZfE/81zJELNcin21BYyroCrU3YLY0A2SQigFYl1FVTPxclgevGqiy+j4iu3HT4Fl1fsZoGTgtakZnipr+xNY3VT97YWlvixMa3H/eNszyqc7IeW4Y4VbrH8DhBNcSEZc2Qo6wf1/zonvA1ndAZeFOrDAOryWJllddXz8w8t9vEMwWz6efuVh/VySwJNVqTSfjk7gWl5qobZpSQIDAQAB-----END RSA PUBLIC KEY-----');

                const integrationClientIdentificator = 'medic';
                mit.sharedData.integrationClientIdentificator = integrationClientIdentificator

                console.log('MIT', mit);

                const session = await mit.session()
                console.log('SESSION', session);

                const req = await mit.normalizeModel(
                    {
                        "from": integrationClientIdentificator,
                        "payload":{
                            "identificationData": {
                                "cpf": "616.829.326-48",
                                "isForeign": false
                            },
                            "personalData": {
                                "name": "Andreau",
                                "lastName": "Loureiro",
                                "secondLastName": "Perez",
                                "motherName": "Da Silva",
                                "phoneNumber": "4859485495894",
                                "email": "andreau.loureiro@yopmail.com",
                                "breed": "",
                                "gender": "",
                                "birthdate": "22/12/1981",
                                "nacionality": ""
                            },
                            "addressData": {
                                "cep": "99438939",
                                "uf": "893475938457",
                                "city": "98347984573",
                                "neighborhood": "",
                                "street": "Samba St",
                                "streetNumber": "8893"
                            },
                            "password": "MedicB2COnline!"
                        }
                    }
                )

                console.log('patient normalized', req.data);

                const newPatient = await mit.createPatient(req.data)
                console.log('patient created', newPatient.data);

                const login = await mit.login()
                console.log('login', login.data);

                const inmediate = await mit.reserveInmediateAppointment()
                console.log('inmediate reserve', inmediate.data);

                const consolidate = await mit.consolidateInmediateAppointment([])
                console.log('inmediate consolidate', consolidate.data);

                const appointmentPayload = await mit.getAppointmentIdByExternalId()
                console.log("Get appointment by caseId OK", appointmentPayload);

                const magicLink = mit.magicLink()
                console.log('maic link', magicLink);

                /*
                            const listProfessionals = await mit.listProfessionals()
                            console.log('list profesionals', listProfessionals.data);
                
                            // medico
                            const specialties = await mit.listSpecialties('5f35e707127b082ccd516c1b')
                            console.log('list specialties', specialties.data);
                
                            // medico general
                            const blocks = await mit.listBlocks({
                                date: {
                                    month: 8,
                                    year: 2021,
                                    day: 19
                                },
                                specailtyId: "6001fd6deb69bb33a2ae41b9"
                            })
                            console.log('list blocks', blocks.data);
                
                            const reserve = await mit.reserveSheduledAppointment({
                                appointmentType: "agendamiento",
                                professionalDetails: {
                                    specialtyId: "6001fd6deb69bb33a2ae41b9",
                                    userId: "611e6f7c92e36c0b6f81fa34",
                                    specialtyDetails: {
                                        price: 0
                                    }
                                },
                                dateDetails: {
                                    date: {
                                        year: 2021,
                                        month: 8,
                                        day: 19
                                    },
                                    start: "15:30"
                                }
                            })
                            console.log('reserve', reserve.data);
                
                            const consolidate = await mit.consolidateSheduledAppointment([])
                            console.log('consolidate', consolidate.data);
                
                            let url = consolidate.data.payload.paymentUrl
                            window.open(url)
                */
            } catch (error) {
                console.error('Mit Error', error.toObject());
            }

        </script>
    </head>
</body>